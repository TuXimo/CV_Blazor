@using CV_Blazor.Models
@using CV_Blazor.Components
@using CV_Blazor.Services
@using Microsoft.Extensions.Localization
@using System.Globalization

@inherits LayoutComponentBase
@implements IAsyncDisposable

@inject IStringLocalizer<Resources> Localizer
@inject LocalizationService LocService


@code {
    [Parameter] public PortfolioViewModel? Portfolio { get; set; }

    private IJSObjectReference? _aboutMeModule;

    [Inject]
    private IJSRuntime JSRuntime { get; set; } = null!;

    protected override void OnInitialized()
    {
        LocService.OnChange += StateHasChanged;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _aboutMeModule = await JSRuntime.InvokeAsync<IJSObjectReference>("import", "./js/about-me.js");
            if (_aboutMeModule is not null)
            {
                await _aboutMeModule.InvokeVoidAsync("createCodeParticles");
                await _aboutMeModule.InvokeVoidAsync("initializeProfileImageTilt");
            }
        }
    }

    public async ValueTask DisposeAsync()
    {
        LocService.OnChange -= StateHasChanged;
        if (_aboutMeModule != null)
        {
            await _aboutMeModule.InvokeVoidAsync("destroyCodeParticles");
            await _aboutMeModule.InvokeVoidAsync("disposeProfileImageTilt");
            await _aboutMeModule.DisposeAsync();
        }
    }
}

<section id="about-me">
    <div id="particles-container"></div> <!-- partículas -->
    <div id="code-text-container"></div> <!-- textos flotantes -->

    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8 text-center text-md-start">
                <h1 class="display-4">@Localizer["ab_Title"]</h1>

                @foreach (var paragraph in Portfolio!.Resume.Summary)
                {
                    <p class="lead">@paragraph</p>
                }

                @{
                    var culture = CultureInfo.CurrentUICulture.Name;
                    var cvFile = culture switch
                    {
                        "es-ES" => "files/cv_es.pdf",
                        _ => "files/cv_en.pdf"
                    };
                }

                <div class="d-flex flex-wrap gap-3 mt-3">
                    <a href="#projects" class="btn btn-primary btn-lg about-me-btn">@Localizer["ab_Projects"]</a>
                    <a href="@cvFile" class="btn btn-primary btn-lg about-me-btn" download>@Localizer["ab_DownloadCV"]</a>
                </div>
            </div>

            <div class="col-md-4 mt-4 mt-md-0 text-center profile-image-container">
                <img src="img/profile.jpg" alt="Maximo Brunetti" class="profile-image" />
            </div>
        </div>
    </div>
</section>
